
def get_rev [ node: string ] {
  get_metadata_json
  | get locks.nodes
  | get $node
}
export def path_with_rev [ ] {
  get_metadata_json
  | flatten record-paths -s "->" # Returns a table with two columns: path and value
  | where { $in.path ends-with "aeson-nau" }
  | each {|row| get_rev $row.value}
}

def get_metadata_json [] {
  nix flake metadata --json ../euler-api-customer
  | from json 
}


